---
title: "Загрузка файлов"
description: ""
---

### Всегда проверяйте тип и размер файла

Всегда проверяйте тип файла (расширение или MIME-тип) и размер файла, чтобы избежать атак на отказ в обслуживании хранилища и выполнение удаленного кода:

```php
$request->validate([
'photo' => 'file|size:100|mimes:jpg,bmp,png'
]);
```

Атаки на отказ в обслуживании хранилища используют отсутствие проверок размера файла и загружают огромные файлы, исчерпывая дисковое пространство.

Атаки на выполнение удаленного кода включают загрузку вредоносных исполняемых файлов (таких как файлы PHP) и затем запуск их вредоносного кода, посещая URL-адрес файла (если он публичный).

Обе эти атаки можно предотвратить с помощью простых проверок файлов, как указано выше.

### Не доверяйте вводу пользователя для определения имен файлов или путей

Если ваше приложение позволяет пользовательским данным управлять путем файла для загрузки, это может привести к перезаписи критического файла или сохранению файла в неподходящем месте.

Рассмотрим следующий код:

```php
Route::post('/upload', function (Request $request) {
$request->file('file')->storeAs(auth()->id(), $request->input('filename'));

return back();
});
```

Этот маршрут сохраняет файл в каталоге, специфическом для идентификатора пользователя. Здесь мы полагаемся на данные ввода пользователя `filename`, и это может привести к уязвимости, поскольку имя файла может быть что-то вроде `../2/filename.pdf`. Это приведет к загрузке файла в каталог пользователя с идентификатором 2, а не в каталог, соответствующий текущему вошедшему пользователю.

Чтобы исправить это, мы должны использовать функцию PHP `basename`, чтобы удалить любую информацию о директории из данных ввода `filename`:

```php
Route::post('/upload', function (Request $request) {
$request->file('file')->storeAs(auth()->id(), basename($request->input('filename')));

return back();
});
```

### Избегайте обработки ZIP или XML файлов, если это возможно

Файлы XML могут подвергнуть ваше приложение широкому спектру атак, таких как атаки XXE, атаки на миллиард лафов и другие. Если вы обрабатываете ZIP-файлы, вы можете подвергнуться атакам на отказ в обслуживании ZIP-бомбы.

См. [Шпаргалку по безопасности XML](XML_Security_Cheat_Sheet.md) и [Шпаргалку по загрузке файлов](File_Upload_Cheat_Sheet.md), чтобы узнать больше.
