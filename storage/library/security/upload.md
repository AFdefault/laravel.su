---
title: "Загрузка файлов"
description: "Всегда проверяйте тип файла и не доверяйте пользователю определять имена файлов или пути."
---

Всегда проверяйте тип файла (расширение или MIME-тип), чтобы избежать выполнение удаленного кода:

```php
$request->validate([
    'photo' => 'file|size:100|mimes:jpg,bmp,png'
]);
```

Атаки на выполнение удаленного кода включают загрузку вредоносных исполняемых файлов (например файлы PHP) и затем запуск их вредоносного кода, посещая URL-адрес файла (если он публичный).

По возможности старайтесь избегать обработки ZIP/XML файлов, так как они могут быть использованы для атак. Например, XXE и XEE атаки для XML и атаки на отказ в обслуживании для ZIP файлов (ZIP-бомбы).


Если ваше приложение позволяет пользовательским данным управлять путем файла для загрузки, это может привести к перезаписи критического файла или сохранению файла в неподходящем месте.

Рассмотрим следующий код:

```php
Route::post('/upload', function (Request $request) {
    $request->file('file')->storeAs(
        $request->user()->id(),
        $request->input('filename')
     );

    return back();
});
```

Этот маршрут сохраняет файл в каталоге, специфическом для идентификатора пользователя. Здесь мы полагаемся на данные ввода пользователя `filename`, и это может привести к уязвимости, поскольку имя файла может быть что-то вроде `../2/filename.pdf`. Это приведет к загрузке файла в каталог пользователя с идентификатором 2, а не в каталог, соответствующий текущему вошедшему пользователю.

Чтобы исправить это, мы должны использовать функцию PHP `basename`, чтобы удалить любую информацию о директории из данных ввода `filename`:

```php
Route::post('/upload', function (Request $request) {
    $request->file('file')->storeAs(
        $request->user()->id(),
        basename($request->input('filename'))
     );

    return back();
});
```

